-- 使用 diagram.nvim 在 Neovim 中渲染 Mermaid、PlantUML、D2 等圖表
-- 需要安裝 graphviz、mermaid-cli、plantuml 等外部工具
return {
  {
    "3rd/diagram.nvim",
    enabled = true,
    lazy = true, -- 只在需要時載入，避免啟動變慢
    ft = { "markdown", "mermaid", "plantuml", "d2" }, -- 開啟這些檔案類型才載入
    dependencies = {
      "3rd/image.nvim", -- 需要 image.nvim 來渲染圖片
    },
    opts = {
      -- 自動轉換圖表的事件
      -- 您可改成 {"BufWritePost"}，代表存檔時才渲染
      render_on_events = { "TextChanged", "InsertLeave" },

      -- 渲染方式：直接內嵌在 buffer 裡
      renderer = "image.nvim",

      -- 支援的後端：Mermaid、PlantUML、d2…
      mermaid = {
        theme = "default", -- 預設主題，可選 'dark' 'neutral' 'forest'
        background = "transparent", -- 背景透明
        scale = 1.0, -- 縮放倍率
      },
    },
    keys = {
      -- 一鍵渲染當前圖表
      {
        "<leader>dm",
        function()
          require("diagram").render()
        end,
        desc = "Render Diagram",
      },
      -- 一鍵清除預覽
      {
        "<leader>dM",
        function()
          require("diagram").clear()
        end,
        desc = "Clear Diagram Preview",
      },
    },
  },
}
